# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç–∞ —Ä–µ—á–∏ –≤–æ –≤—Ä–µ–º—è TTS

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—Ä–∞—Ç–∏–ª –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É: **–∫–æ–≥–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç TTS, –æ–Ω–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —á—Ç–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å**. –≠—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### **–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
#### –î–ª—è –¥–∏–Ω–∞–º–∏–∫–æ–≤:
```csharp
if (isTTSActive || (speechSynthesizer?.State == System.Speech.Synthesis.SynthesizerState.Speaking))
{
    return; // –ò–ì–ù–û–†–ò–†–£–ï–ú –†–ï–ß–¨ –°–û–ë–ï–°–ï–î–ù–ò–ö–ê! ‚ùå
}
```

#### –î–ª—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:
```csharp
// –í–û–û–ë–©–ï –ù–ï –ë–´–õ–û –ü–†–û–í–ï–†–ö–ò TTS!
// –ú–∏–∫—Ä–æ—Ñ–æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å, –∞ –¥–∏–Ω–∞–º–∏–∫–∏ - –Ω–µ—Ç ‚ùå
```

### **–ü—Ä–æ–±–ª–µ–º—ã:**
1. üö´ **–ü–æ—Ç–µ—Ä—è —Ä–µ—á–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞** –≤–æ –≤—Ä–µ–º—è –Ω–∞—à–µ–≥–æ TTS
2. ‚öñÔ∏è **–ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–ª, –¥–∏–Ω–∞–º–∏–∫–∏ –Ω–µ—Ç
3. üí¨ **–ù–∞—Ä—É—à–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞** - —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–±–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### **–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

#### –î–ª—è –¥–∏–Ω–∞–º–∏–∫–æ–≤:
```csharp
// –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê: –ù–ï –ò–ì–ù–û–†–ò–†–£–ï–ú –†–ï–ß–¨ –°–û–ë–ï–°–ï–î–ù–ò–ö–ê –í–û –í–†–ï–ú–Ø TTS
if (isTTSActive || (speechSynthesizer?.State == System.Speech.Synthesis.SynthesizerState.Speaking))
{
    if (smartAudioManager != null)
    {
        // –ö–æ–ø–∏—Ä—É–µ–º –∞—É–¥–∏–æ–¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
        byte[] currentAudio = new byte[e.BytesRecorded];
        Array.Copy(e.Buffer, currentAudio, e.BytesRecorded);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ü–û–°–õ–ï TTS ‚úÖ
        smartAudioManager.QueueAudioSegment(currentAudio, DateTime.Now, "tts_period");
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –±—É—Ñ–µ—Ä –µ—Å–ª–∏ –∏–¥–µ—Ç –∑–∞–ø–∏—Å—å
        if (isCollectingAudio && audioBuffer.Count > 0)
        {
            byte[] bufferedAudio = audioBuffer.ToArray();
            smartAudioManager.QueueAudioSegment(bufferedAudio, DateTime.Now, "tts_buffered");
            audioBuffer.Clear();
            isCollectingAudio = false;
        }
    }
    return; // –ê—É–¥–∏–æ –°–û–•–†–ê–ù–ï–ù–û –≤ –æ—á–µ—Ä–µ–¥–∏ ‚úÖ
}
```

#### –î–ª—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞):
```csharp
// –ö–û–ù–°–ò–°–¢–ï–ù–¢–ù–ê–Ø –õ–û–ì–ò–ö–ê: –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –≤–æ –≤—Ä–µ–º—è TTS
if (isTTSActive || (speechSynthesizer?.State == System.Speech.Synthesis.SynthesizerState.Speaking))
{
    if (smartAudioManager != null)
    {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º 16-bit –≤ 32-bit float –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
        byte[] convertedBuffer = ConvertMicrophoneData(e.Buffer, e.BytesRecorded);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å–ª–µ TTS ‚úÖ
        smartAudioManager.QueueAudioSegment(convertedBuffer, DateTime.Now, "tts_microphone");
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –±—É—Ñ–µ—Ä –µ—Å–ª–∏ –∏–¥–µ—Ç –∑–∞–ø–∏—Å—å
        if (isCollectingAudio && audioBuffer.Count > 0)
        {
            byte[] bufferedAudio = audioBuffer.ToArray();
            smartAudioManager.QueueAudioSegment(bufferedAudio, DateTime.Now, "tts_mic_buffered");
            audioBuffer.Clear();
            isCollectingAudio = false;
        }
    }
    return; // –ê—É–¥–∏–æ –°–û–•–†–ê–ù–ï–ù–û –≤ –æ—á–µ—Ä–µ–¥–∏ ‚úÖ
}
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **–¢–µ–ø–µ—Ä—å –≤–æ –≤—Ä–µ–º—è TTS –ø—Ä–æ–≥—Ä–∞–º–º–∞:**
1. üéß **–ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–ª—É—à–∞—Ç—å** —Ä–µ—á—å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
2. üíæ **–ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ** –≤ –æ—á–µ—Ä–µ–¥–∏ SmartAudioManager
3. ‚è≥ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ** –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è TTS
4. üîÑ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç** –¥–ª—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –¥–∏–Ω–∞–º–∏–∫–æ–≤

### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üí¨ **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥** - —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–±–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
- üìä **–ë–µ–∑ –ø–æ—Ç–µ—Ä—å –¥–∞–Ω–Ω—ã—Ö** - –≤—Å—è —Ä–µ—á—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- ‚öñÔ∏è **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∞—É–¥–∏–æ
- üîÑ **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è —Ä–µ—á—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ TTS

## üéØ –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

### **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∞—É–¥–∏–æ —Ç–µ–ø–µ—Ä—å –ø–æ–º–µ—á–∞—é—Ç—Å—è:**
- `"tts_period"` - –∞—É–¥–∏–æ —Å –¥–∏–Ω–∞–º–∏–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è TTS
- `"tts_microphone"` - –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –≤–æ –≤—Ä–µ–º—è TTS  
- `"tts_buffered"` / `"tts_mic_buffered"` - –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ä–µ—á—å

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏:**
- –ú–µ—Ç–æ–¥ `ProcessAudioSegmentFromQueue()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è TTS
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ—á–∏

## üöÄ –ò—Ç–æ–≥
–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤–µ–¥–µ—Ç —Å–µ–±—è –∫–∞–∫ **–Ω–∞—Å—Ç–æ—è—â–∏–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –Ω–µ —Ç–µ—Ä—è–µ—Ç —Ä–µ—á—å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞, –∞ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –µ—ë –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞!