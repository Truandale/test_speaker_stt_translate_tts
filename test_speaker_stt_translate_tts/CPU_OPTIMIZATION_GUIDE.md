# CPU Optimization Guide - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä

## üöÄ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞ –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏–∑-–∑–∞:
1. **–í—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞** (100–º—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª)
2. **–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ** –¥–∞–∂–µ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è
3. **–ò–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. **–ß–∞—Å—Ç–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** –≤ UI –ø–æ—Ç–æ–∫
5. **–î–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–∞–∂–¥–æ–≥–æ –∞—É–¥–∏–æ—Å–µ–º–ø–ª–∞**

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. üïí –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞ –∞—É–¥–∏–æ—É—Ä–æ–≤–Ω—è

**–ë—ã–ª–æ:**
```csharp
audioLevelTimer.Interval = 100; // Update every 100ms
```

**–°—Ç–∞–ª–æ:**
```csharp
audioLevelTimer.Interval = 250; // üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 250–º—Å
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å 10 —Ä–∞–∑/—Å–µ–∫ –¥–æ 4 —Ä–∞–∑/—Å–µ–∫ (-60% –≤—ã–∑–æ–≤–æ–≤)

### 2. üéØ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```csharp
private int lastAudioPercentage = -1;
private DateTime lastUIUpdate = DateTime.MinValue;
private const int UI_UPDATE_INTERVAL_MS = 200;
```

**–£–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
```csharp
bool shouldUpdate = (percentage != lastAudioPercentage) || 
                   (now - lastUIUpdate).TotalMilliseconds > UI_UPDATE_INTERVAL_MS;

if (shouldUpdate)
{
    // –û–±–Ω–æ–≤–ª—è–µ–º UI —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
    progressAudioLevel.Value = percentage;
    lblAudioLevel.Text = $"üìä –£—Ä–æ–≤–µ–Ω—å: {percentage}%";
    
    lastAudioPercentage = percentage;
    lastUIUpdate = now;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (-80% –æ–ø–µ—Ä–∞—Ü–∏–π)

### 3. ‚ö° Throttling –∞—É–¥–∏–æ–æ–±—Ä–∞–±–æ—Ç–∫–∏

**–î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç—ã:**
```csharp
private DateTime lastAudioProcessTime = DateTime.MinValue;
private const int AUDIO_THROTTLE_MS = 50; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª

// –í OnAudioDataAvailable:
if ((now - lastAudioProcessTime).TotalMilliseconds < AUDIO_THROTTLE_MS)
{
    return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –≤—ã–∑–æ–≤—ã
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ 20 —Ä–∞–∑/—Å–µ–∫ –º–∞–∫—Å–∏–º—É–º (-75% –≤—ã–∑–æ–≤–æ–≤)

### 4. üé§ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏–æ—Å–µ–º–ø–ª–æ–≤

**–ë—ã–ª–æ (–∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–µ–º–ø–ª–∞):**
```csharp
for (int i = 0; i < bytesRecorded - 3; i += 4)
{
    float sample = BitConverter.ToSingle(buffer, i);
    sum += Math.Abs(sample);
}
```

**–°—Ç–∞–ª–æ (–∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ 4-–≥–æ —Å–µ–º–ø–ª–∞):**
```csharp
const int SKIP_SAMPLES = 4; // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π 4-–π —Å–µ–º–ø–ª

for (int i = 0; i < bytesRecorded - 3; i += 4 * SKIP_SAMPLES)
{
    if (i + 3 < bytesRecorded)
    {
        float sample = BitConverter.ToSingle(buffer, i);
        sum += Math.Abs(sample);
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ 75%

### 5. üìù –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–æ–±–∞–≤–ª–µ–Ω—ã —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
```csharp
private bool enableDetailedLogging = false; // –û—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

private void LogMessageDebug(string message)
{
    if (enableDetailedLogging)
    {
        LogMessage(message); // –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    }
    else
    {
        Debug.WriteLine($"[{DateTime.Now:HH:mm:ss.fff}] {message}"); // –¢–æ–ª—å–∫–æ Debug
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò—Å–∫–ª—é—á–µ–Ω–∏–µ UI –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –Ω–µ–≤–∞–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (-90% UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)

### 6. üîá –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ –≤—Ä–µ–º—è TTS

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TTS –ø–µ—Ä–∏–æ–¥–∞:**
```csharp
if (isTTSActive || speechSynthesizer?.State == SynthesizerState.Speaking)
{
    // üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã
    float level = CalculateAudioLevel(e.Buffer, e.BytesRecorded);
    if (level > voiceThreshold * 0.5f) // –¢–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    {
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
        smartAudioManager.QueueAudioSegment(currentAudio, now, "tts_period");
    }
    return;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ –≤—Ä–µ–º—è TTS –Ω–∞ 80%

## üìä –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚è±Ô∏è –¢–∞–π–º–µ—Ä: 10 —Ä–∞–∑/—Å–µ–∫ √ó –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- üéµ –ê—É–¥–∏–æ: –ö–∞–∂–¥—ã–π —Å–µ–º–ø–ª √ó –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- üìù –õ–æ–≥–∏: –í—Å–µ –≤ UI –ø–æ—Ç–æ–∫
- üîÑ Throttling: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚è±Ô∏è –¢–∞–π–º–µ—Ä: 4 —Ä–∞–∑–∞/—Å–µ–∫ √ó —É–º–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- üéµ –ê—É–¥–∏–æ: –ö–∞–∂–¥—ã–π 4-–π —Å–µ–º–ø–ª √ó throttling 50–º—Å
- üìù –õ–æ–≥–∏: Debug + –≤—ã–±–æ—Ä–æ—á–Ω—ã–π UI
- üîÑ Throttling: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU

1. **–¢–∞–π–º–µ—Ä –∞—É–¥–∏–æ—É—Ä–æ–≤–Ω—è**: -60% –≤—ã–∑–æ–≤–æ–≤
2. **UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: -80% –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ê—É–¥–∏–æ–æ–±—Ä–∞–±–æ—Ç–∫–∞**: -75% —á–∞—Å—Ç–æ—Ç—ã + -75% —Å–µ–º–ø–ª–æ–≤ = -94% –æ–±—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: -90% UI –æ–ø–µ—Ä–∞—Ü–∏–π
5. **TTS –ø–µ—Ä–∏–æ–¥**: -80% –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–û–±—â–µ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU: 70-80%** üöÄ

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ï—Å–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ –µ—â–µ –≤—ã—Å–æ–∫–∞:

1. **–£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:**
```csharp
audioLevelTimer.Interval = 500; // –î–æ 2 —Ä–∞–∑/—Å–µ–∫
AUDIO_THROTTLE_MS = 100; // –î–æ 10 —Ä–∞–∑/—Å–µ–∫
```

2. **–í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏:**
```csharp
enableDetailedLogging = true; // –¢–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```

3. **–ë–æ–ª—å—à–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–µ–º–ø–ª—ã:**
```csharp
const int SKIP_SAMPLES = 8; // –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π 8-–π —Å–µ–º–ø–ª
```

## ‚úÖ –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω**: –í—Å–µ —Å–µ–º–∞—Ñ–æ—Ä—ã –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
2. **–ö–∞—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏**: –°–Ω–∏–∂–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞ —É—Ä–æ–≤–Ω—è –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ
3. **–û—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å UI**: –£–ª—É—á—à–µ–Ω–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è —É–º–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é
4. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –í—Å–µ –∑–∞—â–∏—Ç—ã –æ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

**–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–µ–ø–µ—Ä—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, —Å–æ—Ö—Ä–∞–Ω—è—è –≤—Å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å!** üéâ