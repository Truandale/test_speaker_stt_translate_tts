# –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ - –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –ò—Ç–æ–≥–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏—è

#### 1. –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- **–ó–∞–º–µ–Ω–µ–Ω–æ**: `Task.Delay(...).Wait()` (–±–ª–æ–∫–∏—Ä—É—é—â–∏–π)
- **–ù–∞**: `Forms.Timer` (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π) 
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: UI –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º –≤–æ –≤—Ä–µ–º—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

#### 2. –ï–¥–∏–Ω—ã–π tempPath –≤ —Ç–µ–ª–µ —Ü–∏–∫–ª–∞
- **–î–æ–±–∞–≤–ª–µ–Ω–æ**: –ß–µ—Ç–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è**: `string tempPath = filePath + ".tmp";`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ò–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- **–î–æ–±–∞–≤–ª–µ–Ω–æ**: `Directory.CreateDirectory(Path.GetDirectoryName(filePath)!);`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫

#### 4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è**: `PerformOptimizedSave(int retryCount = 0)`
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: `ScheduleRetryAsync()`
- **–û—á–∏—Å—Ç–∫–∞**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è `OnFormClosing()`

### üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```csharp
// –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ Forms.Timer
private void ScheduleRetryAsync()
{
    if (_retryTimer == null)
    {
        _retryTimer = new Forms.Timer();
        _retryTimer.Interval = RetryDelayMs;
        _retryTimer.Tick += (s, e) => {
            _retryTimer.Stop();
            PerformOptimizedSave(_currentRetryCount);
        };
    }
    _currentRetryCount++;
    _retryTimer.Start();
}

// –ï–¥–∏–Ω—ã–π tempPath + —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
private void PerformOptimizedSave(int retryCount = 0)
{
    try 
    {
        string filePath = GetConfigFilePath();
        Directory.CreateDirectory(Path.GetDirectoryName(filePath)!);
        
        string tempPath = filePath + ".tmp";
        // ... –∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å
    }
    catch (IOException ex) when (retryCount < MaxRetryAttempts)
    {
        ScheduleRetryAsync();
    }
}
```

### üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏

1. **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π UI**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤
2. **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å**: File.Replace() –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–ø–∏—Å–∏
3. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ IOException
4. **–û—á–∏—Å—Ç–∫–∞**: –£–¥–∞–ª–µ–Ω–∏–µ .tmp —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 500ms throttling —Å dirty flag
6. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚ú® Enterprise-grade —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: File.Replace() –ø–∞—Ç—Ç–µ—Ä–Ω
- **UTF-8 –±–µ–∑ BOM**: –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å  
- **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –ø–æ–≤—Ç–æ—Ä—ã**: Forms.Timer –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤**: Comprehensive disposal patterns
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è throttling**: Coalescence mechanism
- **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Structured exception handling

### üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–∏–ª—è—Ü–∏–∏: ‚úÖ –£–°–ü–ï–®–ù–û

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –∏ –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---
*–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è JSON —Å enterprise-grade –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å—é*