# –ü–æ—Ç–æ–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ STT-–ü–µ—Ä–µ–≤–æ–¥-TTS –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–µ—á–∏

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∂–¥–∞–ª–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ—á–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è **–¥–ª–∏–Ω–Ω—ã—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π** –∏ –ª–µ–∫—Ü–∏–π.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ü–æ—Ç–æ–∫–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. **StreamingAudioProcessor.cs**
**–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –ø–∞—É–∑**

#### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- ‚úÖ **–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —á–∞–Ω–∫–æ–≤** (500–º—Å) –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** (–¥–æ 3 —á–∞–Ω–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è** –±—É—Ñ–µ—Ä–∞
- ‚úÖ **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ –≤—Ä–µ–º—è TTS** (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —ç—Ö–∞)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
```csharp
streamChunkSizeMs = 3000;     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫
overlapMs = 500;              // –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 0.5 —Å–µ–∫
voiceThreshold = 0.05f;       // –ü–æ—Ä–æ–≥ –≥–æ–ª–æ—Å–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
maxParallelProcessing = 3;    // –ú–∞–∫—Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
```

#### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:
```
–ê—É–¥–∏–æ –ø–æ—Ç–æ–∫ ‚Üí –ë—É—Ñ–µ—Ä (3 —Å–µ–∫) ‚Üí –ß–∞–Ω–∫ #1 ‚Üí STT (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
                ‚Üì (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 0.5 —Å–µ–∫)
             –ë—É—Ñ–µ—Ä (3 —Å–µ–∫) ‚Üí –ß–∞–Ω–∫ #2 ‚Üí STT (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
                ‚Üì (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 0.5 —Å–µ–∫)
             –ë—É—Ñ–µ—Ä (3 —Å–µ–∫) ‚Üí –ß–∞–Ω–∫ #3 ‚Üí STT (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
```

### 2. **StreamingResultManager.cs**
**–£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –ø–µ—Ä–µ–≤–æ–¥–æ–º –∏ TTS**

#### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥** —á–∞–Ω–∫–æ–≤ (–¥–æ 2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- ‚úÖ **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞** –∏–∑ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤
- ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–≥–ª—É—à–µ–∫** –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- ‚úÖ **–û—á–µ—Ä–µ–¥—å TTS** —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
- ‚úÖ **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏** (—Ö—Ä–∞–Ω–∏—Ç 50 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```
–ß–∞–Ω–∫ STT ‚Üí –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ ‚Üí –ü–µ—Ä–µ–≤–æ–¥ ‚Üí –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ‚Üí TTS ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### ‚è±Ô∏è **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞:**
- **3 —Å–µ–∫—É–Ω–¥—ã** –¥–æ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –ø–∞—É–∑—ã)
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞–Ω–∫–æ–≤
- **–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ—Ä—é —Å–ª–æ–≤ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö

### üîÑ **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å:**
- **–ù–µ –∂–¥–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ—á–∏** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
- **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π** –ª—é–±–æ–π –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–º** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ

### üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è** TTS‚ÜíSTT
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ

### üéØ **–ö–∞—á–µ—Å—Ç–≤–æ:**
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–≥–ª—É—à–µ–∫ Whisper** –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
- **–ê–Ω–∞–ª–∏–∑ —Ä–µ—á–µ–≤—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫** –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —à—É–º–∞
- **–£–º–Ω—ã–π –≤—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ TTS** –ø–æ —è–∑—ã–∫—É
- **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å–≤—è–∑–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞** –∏–∑ —á–∞–Ω–∫–æ–≤

## üìã –°—Ö–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ Form1.cs

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```csharp
private StreamingAudioProcessor streamingProcessor;
private StreamingResultManager resultManager;
private EnhancedTTSEngine enhancedTTS;

private void InitializeStreaming()
{
    enhancedTTS = new EnhancedTTSEngine();
    resultManager = new StreamingResultManager(enhancedTTS);
    streamingProcessor = new StreamingAudioProcessor();
    
    // –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
    streamingProcessor.ChunkReadyForSTT += ProcessChunkSTT;
    streamingProcessor.StreamingResultReceived += resultManager.AddStreamingResult;
    resultManager.TranslationRequested += TranslateText;
    resultManager.CurrentTextUpdated += UpdateUI;
}
```

### –®–∞–≥ 2: –ó–∞–º–µ–Ω–∞ –≤ OnAudioDataAvailable
```csharp
private void OnAudioDataAvailable(object? sender, WaveInEventArgs e)
{
    if (!isCapturing) return;
    
    float level = CalculateAudioLevel(e.Buffer, e.BytesRecorded);
    
    // –ù–û–í–ê–Ø –ü–û–¢–û–ö–û–í–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê:
    _ = streamingProcessor.ProcessStreamingAudio(e.Buffer, e.BytesRecorded, level);
}
```

### –®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ STT
```csharp
private async Task<string> ProcessChunkSTT(byte[] audioData, int chunkNumber)
{
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WAV –∏ Whisper STT
    var wavData = ConvertToWav(audioData);
    var result = await PerformWhisperSTT(wavData);
    return result;
}
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ **–î–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑ (3-10 —Å–µ–∫):**
- –ó–∞–¥–µ—Ä–∂–∫–∞: **~3 —Å–µ–∫—É–Ω–¥—ã** –¥–æ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –ö–∞—á–µ—Å—Ç–≤–æ: **–í—ã—Å–æ–∫–æ–µ** (–æ–¥–∏–Ω —á–∞–Ω–∫)

### ‚úÖ **–î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–π (10-30 —Å–µ–∫):**
- –ó–∞–¥–µ—Ä–∂–∫–∞: **~3 —Å–µ–∫** –¥–æ –ø–µ—Ä–≤–æ–≥–æ —á–∞–Ω–∫–∞, –∑–∞—Ç–µ–º –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫ –Ω–æ–≤—ã–µ
- –ö–∞—á–µ—Å—Ç–≤–æ: **–û—Ç–ª–∏—á–Ω–æ–µ** (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å)

### ‚úÖ **–î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π (–º–∏–Ω—É—Ç—ã-—á–∞—Å—ã):**
- –ó–∞–¥–µ—Ä–∂–∫–∞: **–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è** ~3 —Å–µ–∫ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏
- –ö–∞—á–µ—Å—Ç–≤–æ: **–°—Ç–∞–±–∏–ª—å–Ω–æ–µ** (–∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: **–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –ë—ã—Å—Ç—Ä–∞—è —Ä–µ—á—å (–Ω–æ–≤–æ—Å—Ç–∏):
```csharp
streamingProcessor.ConfigureStreaming(
    chunkSizeMs: 2000,    // –ß–∞–Ω–∫–∏ –ø–æ 2 —Å–µ–∫
    overlapMs: 300,       // –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 0.3 —Å–µ–∫
    threshold: 0.03f      // –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥
);
```

### –õ–µ–∫—Ü–∏–∏ –∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏:
```csharp
streamingProcessor.ConfigureStreaming(
    chunkSizeMs: 4000,    // –ß–∞–Ω–∫–∏ –ø–æ 4 —Å–µ–∫
    overlapMs: 800,       // –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 0.8 —Å–µ–∫
    threshold: 0.05f      // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä–æ–≥
);
```

### –¢–∏—Ö–∞—è —Ä–µ—á—å:
```csharp
streamingProcessor.ConfigureStreaming(
    chunkSizeMs: 3000,    // –°—Ç–∞–Ω–¥–∞—Ä—Ç
    overlapMs: 500,       // –°—Ç–∞–Ω–¥–∞—Ä—Ç
    threshold: 0.02f      // –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥
);
```

## üéâ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã!** 

–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `OnAudioDataAvailable` –∏ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Ä–µ—á—å **–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ–≥–æ 3 —Å–µ–∫—É–Ω–¥—ã, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è! üöÄ