# –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –∑–∞—Ö–≤–∞—Ç–∞ –∞—É–¥–∏–æ –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–æ–≤ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

## üîç –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ **—Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ —Ä–µ—á—å –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ**, –∞ **—Å –¥–∏–Ω–∞–º–∏–∫–æ–≤ –ø–ª–æ—Ö–æ**. –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏** –¥–ª—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –¥–∏–Ω–∞–º–∏–∫–æ–≤.

## üìä –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

#### –ú–∏–∫—Ä–æ—Ñ–æ–Ω (OnMicrophoneDataAvailable):
- ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ VAD** - –ø—Ä—è–º–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø–æ—Ä–æ–≥–æ–º
- ‚úÖ **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è TTS** - –ø—Ä–æ—Å—Ç–æ–π return
- ‚úÖ **–ï–¥–∏–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –æ–¥–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ **16-bit PCM ‚Üí 32-bit float** –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è** - –µ—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å > –ø–æ—Ä–æ–≥–∞, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º

#### –î–∏–Ω–∞–º–∏–∫–∏ (OnAudioDataAvailable):
- ‚ùå **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ SmartAudioManager** - –ø—Ä–æ–≤–µ—Ä–∫–∏ CanProcessAudio()
- ‚ùå **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è TTS** - —Å–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π
- ‚ùå **–°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π —Ä–µ–∂–∏–º** - –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚ùå **32-bit float —Ñ–æ—Ä–º–∞—Ç** - –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- ‚ùå **–£—Å–ª–æ–∂–Ω–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É—Å–ª–æ–≤–∏–π

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –£–ø—Ä–æ—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ TTS
**–ë—ã–ª–æ** (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞):
```csharp
if (smartAudioManager != null && !smartAudioManager.CanProcessAudio())
{
    // –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥–∏ SmartAudioManager
    smartAudioManager.QueueAudioSegment(...);
    return;
}
```

**–°—Ç–∞–ª–æ** (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –∫–∞–∫ —É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞):
```csharp
if (isTTSActive || (speechSynthesizer?.State == System.Speech.Synthesis.SynthesizerState.Speaking))
{
    return; // –í–æ –≤—Ä–µ–º—è TTS –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –≤—Ö–æ–¥—è—â–∏–π –∑–≤—É–∫ (–ö–ê–ö –î–õ–Ø –ú–ò–ö–†–û–§–û–ù–ê)
}
```

### 2. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ Voice Activity Detection
**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–∫–∞—è –∂–µ –ø—Ä–æ—Å—Ç–∞—è VAD –ª–æ–≥–∏–∫–∞ –∫–∞–∫ —É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:**
```csharp
// –ü–†–û–°–¢–ê–Ø –õ–û–ì–ò–ö–ê VAD –ö–ê–ö –î–õ–Ø –ú–ò–ö–†–û–§–û–ù–ê
bool isVoiceDetected = level > voiceThreshold;

if (isVoiceDetected)
{
    if (!isCollectingAudio)
    {
        isCollectingAudio = true;
        audioBuffer.Clear();
        recordingStartTime = DateTime.Now;
        LogMessage($"üîä –ù–∞—á–∞—Ç –∑–∞—Ö–≤–∞—Ç —Ä–µ—á–∏ —Å –¥–∏–Ω–∞–º–∏–∫–æ–≤ (—É—Ä–æ–≤–µ–Ω—å: {level:F3})");
        // ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
    }
    lastVoiceActivity = DateTime.Now;
}
```

### 3. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—É–∑ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
–¢–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **—Ç–µ –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã** —á—Ç–æ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ (maxRecordingMs)
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—É–∑ (silenceDurationMs)  
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –±—É—Ñ–µ—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ UI

### 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
```csharp
// –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π —Ä–µ–∂–∏–º, —Ç–∞–∫–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –µ–≥–æ
if (currentProcessingMode == 1 && streamingProcessor != null && isVoiceDetected)
{
    ProcessStreamingAudio(e.Buffer, e.BytesRecorded, level);
}
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –¢–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç—É –∂–µ –ª–æ–≥–∏–∫—É —á—Ç–æ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω:
1. **–ü—Ä–æ—Å—Ç–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ –ø–æ—Ä–æ–≥—É** - –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
2. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ TTS** - –ø—Ä–æ—Å—Ç–æ–π return –≤–º–µ—Å—Ç–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
3. **–ü—Ä—è–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ VAD** - immediate response –Ω–∞ –≥–æ–ª–æ—Å
4. **–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã** - —Ç–µ –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã
5. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã UI

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- üöÄ **–ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è** –Ω–∞ –≥–æ–ª–æ—Å–æ–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- üîß **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞** - –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- üí™ **–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
- üéØ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è —Ä–∞–±–æ—Ç–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π. –¢–µ–ø–µ—Ä—å –∑–∞—Ö–≤–∞—Ç —Å –¥–∏–Ω–∞–º–∏–∫–æ–≤ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å **—Ç–∞–∫ –∂–µ —Ö–æ—Ä–æ—à–æ** –∫–∞–∫ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—É—é –∏ –Ω–∞–¥–µ–∂–Ω—É—é –ª–æ–≥–∏–∫—É.

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑—é–º–µ
**–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:** –ó–∞–º–µ–Ω–∏–ª–∏ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É SmartAudioManager –Ω–∞ –ø—Ä–æ—Å—Ç—É—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –ª–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –¥–æ–∫–∞–∑–∞–ª–∞ —Å–≤–æ—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏ –∑–∞—Ö–≤–∞—Ç–µ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞. –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∑–∞—Ö–≤–∞—Ç–∞ —Ä–µ—á–∏ —Å –¥–∏–Ω–∞–º–∏–∫–æ–≤.